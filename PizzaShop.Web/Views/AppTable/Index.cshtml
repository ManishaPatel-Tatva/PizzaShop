@{
    ViewData["Title"] = "Tables";
    Layout = "_OrderAppLayout";
}

<!--Heading-->
<div class="d-flex flex-column flex-sm-row justify-content-between align-items-center">

    <div class="blue-text p-2 fs-2 fw-semibold text-nowrap">Table View</div>

    <div class="d-flex flex-wrap justify-content-center gap-2">
        <div class="d-flex gap-2 ">
            <div class="text-nowrap">
                <i class="bi bi-circle-fill light-grey-text"></i>
                <span>Available</span>
            </div>
            <div class="text-nowrap">
                <i class="bi bi-circle text-green fw-bold"></i>
                <span>Selected</span>
            </div>
        </div>
        <div class="d-flex gap-2 ">
            <div class="text-nowrap">
                <i class="bi bi-circle-fill text-green"></i>
                <span>Assigned</span>
            </div>
            <div class="text-nowrap">
                <i class="bi bi-circle-fill text-blue"></i>
                <span>Running</span>
            </div>
        </div>
    </div>
</div>

<!-- Accordian -->
<div class="accordion mt-2" id="accordion-section">
    <!-- Partial View -->
</div>

@section Scripts {

    @* Section Ajax *@
    <script>
        $(document).ready(function () {
            SectionAjax(1);
        });

        function SectionAjax() {
            $.ajax({
                url: '@Url.Action("GetList", "AppTable")',
                type: "GET",
                dataType: "html",
                success: function (data) {
                    $("#accordion-section").html(data);
                },
                error: function (data) {
                    alert("No cards Found");
                    $("#accordion-section").html('Not found!');
                }
            });
        }
    </script>

    @* Formate the time *@
    <script>
        $(document).ready(function () {
            setInterval(updateTimeDifference, 1000);
            updateTimeDifference();
        });

        function updateTimeDifference() {
            document.querySelectorAll(".order-time").forEach(element => {

                const orderTime = element.getAttribute("data-time");

                const now = new Date();
                const diffInSeconds = Math.floor((now - new Date(element.getAttribute("data-time"))) / 1000);

                if (diffInSeconds < 0) {
                    element.querySelector(".time-difference").textContent = "Just now";
                    return;
                }

                let days = Math.floor(diffInSeconds / (24 * 3600));
                let hours = Math.floor((diffInSeconds % (24 * 3600)) / 3600);
                let minutes = Math.floor((diffInSeconds % 3600) / 60);
                let seconds = diffInSeconds % 60;

                element.querySelector(".time-difference").textContent = `${days}days ${hours}hours ${minutes}min ${seconds}sec`;

                if (orderTime === "0001-01-01T00:00:00") {
                    element.querySelector(".time-difference").textContent = "0 min";
                }
            });
        }
    </script>


}
